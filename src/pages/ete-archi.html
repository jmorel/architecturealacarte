{% extends 'layouts/page.html' %}

{% block page_title %}50 lieux en France à voir au moins une fois dans sa vie{% endblock %}

{% block title %}
    L'ete archi de David Abittan
{% endblock %}

{% block intro %}
    <div class="archi-feedback">
        Durant l’été, <a href="https://twitter.com/david_abittan">David Abittan<sup><i class="fa fa-twitter"></i></sup></a>
        nous emmène chaque semaine sur <a href="https://www.franceinter.fr/emissions/l-ete-archi">France Inter</a> à la
        découverte de toutes les époques de l’architecture de France.
    </div>
{% endblock %}

{% block map_context %}
    <ods-dataset-context context="map,tooltip"
                         map-domain="jmorel.opendatasoft.com"
                         map-dataset="ete-archi"
                         tooltip-domain="jmorel.opendatasoft.com"
                         tooltip-urlsync="true"
                         tooltip-dataset="ete-archi">

        <!-- filters -->

        <div class="filters">
            <ods-text-search placeholder="Rechercher..."
                             context="archi"></ods-text-search>
        </div>

        <!-- map + tooltip -->

        <div class="map-tooltip-wrapper">

            <!-- map -->

            <ods-map basemap="mapbox.streets"
                     class="main-map"
                     ng-class="{'main-map--blurry': tooltip.parameters['refine.titre']}"
                     location="6,46.36967,2.71362"
                     toolbar-fullscreen="false"
                     toolbar-geolocation="false"
                     toolbar-drawing="false">
                <ods-map-layer context="map"
                               refine-on-click-context="tooltip"
                               refine-on-click-tooltip-map-field="titre"
                               refine-on-click-tooltip-context-field="titre"
                               picto="dot"
                               show-marker="false"
                               shape-opacity="0.5"
                               point-opacity="1"
                               border-color="#FFFFFF"
                               border-opacity="1"
                               border-size="1"
                               border-pattern="solid"
                               caption="false"
                               title="L'été archi de David Abittan"
                               description="Durant l’été, David Abittan nous emmène chaque semaine à la découverte de toutes les époques de l’architecture de France.">
                </ods-map-layer>
            </ods-map>

            <!-- tooltip -->

            <div class="tooltip"
                 ng-class="{'tooltip--shown': tooltip.parameters['refine.titre'] && !loading}"
                 ods-results="records"
                 ods-results-context="tooltip"
                 ods-results-max="1">
                <div ng-repeat="record in records" class="tooltip-content">
                    {% verbatim %}
                        <div class="tooltip-header">
                            <h2 class="tooltip-title">
                                {{ record.fields.titre }}
                            </h2>
                            <button class="tooltip-close"
                                    type="button"
                                    ng-click="tooltip.parameters['refine.titre'] = undefined;">
                                <i class="fa fa-times" aria-hidden="true"></i>
                            </button>
                        </div>

                        <div class="tooltip-body">
                            <div class="tooltip-hero">
                                <ods-record-image context="archi"
                                                  field="image"
                                                  record="record"
                                                  domain-url="https://jmorel.opendatasoft.com"></ods-record-image>
                                <ods-map basemap="mapbox.streets"
                                         location="{{ '5,' + record.fields.coordonnees[0] + ',' + record.fields.coordonnees[1] }}"
                                         class="tooltip-map"
                                         toolbar-fullscreen="false"
                                         toolbar-geolocation="false"
                                         scroll-wheel-zoom="false"
                                         no-refit="true"
                                         toolbar-drawing="false">
                                    <ods-map-layer context="tooltip"
                                                   refine-on-click-context="dummy"
                                                   picto="dot"
                                                   show-marker="false"
                                                   shape-opacity="0.5"
                                                   point-opacity="1"
                                                   border-color="#FFFFFF"
                                                   border-opacity="1"
                                                   border-size="1"
                                                   border-pattern="solid"
                                                   caption="false"
                                                   title="L'été archi de David Abittan"
                                                   description="Durant l’été, David Abittan nous emmène chaque semaine à la découverte de toutes les époques de l’architecture de France."></ods-map-layer>
                                </ods-map>
                            </div>
                            <div class="tooltip-credits">Crédits : {{ record.fields.credits_image }}</div>
                            <p>
                                <a href="{{ record.fields.page_web }}">Episode du {{ record.fields.date }}</a>
                            </p>
                            <p>
                                {{ record.fields.description }}
                            </p>
                            <p>
                                <a href="{{ record.fields.podcast }}" target="_blank">
                                    <i class="fa fa-play-circle"></i> Ecouter l'épisode
                                </a>
                            </p>
                        </div>
                    {% endverbatim %}
                </div>
            </div>
        </div>
    </ods-dataset-context>
{% endblock %}
